name: TITAN-V150-GHOST-PROTOCOL

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. System Hardening
        run: |
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          pip install psutil requests --quiet
          # Installing 7-Zip to handle portable files
          choco install 7zip -y

      - name: 2. Tailscale Login (Check Logs)
        shell: powershell
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up
          Write-Host "WAITING 120 SECONDS FOR LOGIN..." -ForegroundColor Yellow
          Start-Sleep -Seconds 120
          $tsIP = (& "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4)
          Write-Host "RDP IP: $tsIP" -ForegroundColor Green

      - name: 3. Deploy Ghost-Protocol Script
        run: |
          $password = "Admin@Watch786"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }

          $ghostScript = @"
          import os, time, subprocess, psutil, requests, random

          # --- YOUR DIRECT LINKS ---
          links = [
              "https://www.youtube.com/watch?v=oiyYa3IL2Rc",
              "https://www.youtube.com/watch?v=OXuTuHQqB7s",
              "https://www.youtube.com/watch?v=K9ihEWJn4Go"
          ]

          def launch_ghost_sessions():
              # Direct Winget Firefox Path
              ff_path = r'C:\Program Files\Mozilla Firefox\firefox.exe'
              if not os.path.exists(ff_path):
                  subprocess.run(['winget', 'install', '--id', 'Mozilla.Firefox', '-e', '--silent'])

              print("[GHOST] Initializing 15 Isolated Identities...")
              
              for i in range(15):
                  p_dir = f'C:\Users\Public\Ghost_{i}'
                  if not os.path.exists(p_dir): os.makedirs(p_dir)
                  
                  # Har session ke liye random "Human-like" delay
                  url = random.choice(links)
                  
                  # Firefox unique profile launch
                  # Is se YouTube ko har window alag browser lagegi
                  cmd = [
                      ff_path, 
                      "-new-instance", 
                      "-profile", p_dir,
                      "-no-remote",
                      url
                  ]
                  subprocess.Popen(cmd)
                  print(f"Session {i+1} Ghosting Active.")
                  time.sleep(25) # Bohat zaroori hai taake YouTube spikes na pakde

          while True:
              # Sab purane browsers khatam karna taake RAM fresh rahe
              [p.kill() for p in psutil.process_iter(['name']) if 'firefox' in p.info['name'].lower()]
              time.sleep(10)
              launch_ghost_sessions()
              # 4 Ghante tak chalne dena (Organic Watchtime)
              time.sleep(14400)
          "@
          $ghostScript | Out-File -FilePath "C:\Users\Public\Desktop\GHOST.py" -Encoding ascii
          "@echo off`ntitle GHOST PROTOCOL ACTIVE`npython C:\Users\Public\Desktop\GHOST.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START_GHOST.bat" -Encoding ascii

      - name: 4. Keep Alive
        run: Start-Sleep -Seconds 9000
