name: TITAN-V140-AUTO-PILOT

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. Setup Environment
        run: |
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          pip install psutil pyautogui opencv-python --quiet
          choco install googlechrome --accept-license -y

      - name: 2. Create THE AUTO-CLICKER Master Script
        run: |
          $password = "Admin@Watch786"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }

          $autoPilotScript = @"
          import os
          import time
          import subprocess
          import psutil
          import pyautogui

          # --- YOUR LINKS ---
          links = [
              "https://m.youtube.com/watch?v=oiyYa3IL2Rc",
              "https://m.youtube.com/watch?v=OXuTuHQqB7s",
              "https://m.youtube.com/watch?v=K9ihEWJn4Go",
              "https://m.youtube.com/watch?v=z25lo2mogbk",
              "https://m.youtube.com/watch?v=ZkJlQ_q7x5Q"
          ]

          chrome_path = r'C:\Program Files\Google\Chrome\Application\chrome.exe'
          profile_base = r'C:\Users\Public\TitanAutoPilot'

          def launch_and_connect_vpn():
              print("[AUTO-PILOT] Launching Browsers & Attempting VPN Auto-Click...")
              for i in range(15): # Pehle 15 windows handle karte hain RAM bachane ke liye
                  p_dir = os.path.join(profile_base, f'User_{i}')
                  url = links[i % len(links)]
                  
                  # Force Load Urban VPN (ID: eppiocemhmnlbhjplcgneofghclihonj)
                  subprocess.Popen([
                      chrome_path, 
                      f'--user-data-dir={p_dir}',
                      '--disable-blink-features=AutomationControlled',
                      '--window-size=600,500',
                      url
                  ])
                  
                  time.sleep(12) # Browser load hone ka wait

                  # --- AI MOUSE CLICK LOGIC ---
                  # Ye coordinates typical Urban VPN location par hain (Right side of bar)
                  # Note: Ye RDP ki screen resolution par depend karta hai
                  try:
                      print(f"Profile {i}: Attempting VPN Connection...")
                      # Extension icon click (Assuming it's pinned)
                      pyautogui.click(550, 50) 
                      time.sleep(3)
                      # Connect Button click inside extension popup
                      pyautogui.click(450, 400) 
                  except:
                      print("Mouse Click failed, proceeding to next...")
                  
                  time.sleep(5)

          while True:
              for proc in psutil.process_iter(['name']):
                  if proc.info['name'] == 'chrome.exe': proc.kill()
              time.sleep(5)
              launch_and_connect_vpn()
              time.sleep(14400)
          "@
          
          $autoPilotScript | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_AUTOPILOT.py" -Encoding ascii
          "@echo off`npython C:\Users\Public\Desktop\TITAN_AUTOPILOT.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START_AUTOPILOT.bat" -Encoding ascii

      - name: 3. Final Prep
        run: |
          Write-Host "V140 DEPLOYED!"
          Write-Host "Connect RDP and run START_AUTOPILOT.bat"
          Start-Sleep -Seconds 9000
