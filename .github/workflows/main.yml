name: DUBBED-DHAMAAL-V107-VISIBLE

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. System & Chrome Setup
        run: |
          pip install pyautogui psutil
          choco install googlechrome --accept-license -y

      - name: 2. Tailscale Login
        continue-on-error: true 
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --hostname="titan-visible" --accept-routes --force-reauth
          Start-Sleep -Seconds 20

      - name: 3. Create RDP User & Auto-Start Script
        run: |
          $password = "Admin@Watch786"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }
          
          # Ye script RDP ke andar desktop par save ho jayegi
          $startScript = @"
          import os
          import time
          import subprocess
          
          links = [
              "https://www.youtube.com/watch?v=VIDEO1",
              "https://www.youtube.com/watch?v=VIDEO2",
              "https://www.youtube.com/watch?v=VIDEO3",
              "https://www.youtube.com/watch?v=VIDEO4",
              "https://www.youtube.com/watch?v=VIDEO5"
          ]
          
          chrome_path = r'C:\Program Files\Google\Chrome\Application\chrome.exe'
          
          for i in range(15):
              url = links[i % len(links)]
              profile = f'--user-data-dir=C:\\Profiles\\Titan_{i}'
              flags = [chrome_path, profile, '--no-sandbox', '--mute-audio', '--start-maximized', url]
              subprocess.Popen(flags)
              time.sleep(5)
          "@
          $startScript | Out-File -FilePath "C:\Users\Public\Desktop\Start_Browsers.py" -Encoding ascii

      - name: 4. Anti-Freeze Activation
        run: |
          # Force windows to keep session alive
          reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
          reg add "HKCU\Control Panel\Desktop" /v ScreenSaveActive /t REG_SZ /d 0 /f

      - name: 5. Waiting for RDP Connection
        run: |
          print "!!! ACTION REQUIRED !!!"
          print "1. Connect via RDP using Tailscale IP"
          print "2. Desktop par 'Start_Browsers.py' dikhega"
          print "3. Use Right-Click karke 'Run with Python' karein"
          print "Ab browser aapki screen par khulega aur 0% Network nahi aayega."
          Start-Sleep -Seconds 9000
