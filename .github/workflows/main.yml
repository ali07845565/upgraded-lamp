name: TITAN-V173-FIXED-ULTRA

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. Modern 64GB Virtual RAM & CPU Boost
        shell: powershell
        run: |
          # Faltu services band karna
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          
          # NEW Pagefile Fix (WMIC replacement for 64GB Virtual RAM)
          $pagefile = Get-CimInstance Win32_PageFileSetting
          if ($pagefile) {
              Set-CimInstance -Query "Select * from Win32_PageFileSetting where Name='C:\\pagefile.sys'" -Property @{InitialSize = 32768; MaximumSize = 65536}
          } else {
              New-CimInstance -ClassName Win32_PageFileSetting -Property @{Name="C:\pagefile.sys"; InitialSize=32768; MaximumSize=65536}
          }
          
          Write-Host "64GB Virtual RAM Allocated successfully!" -ForegroundColor Green
          pip install pyautogui psutil --quiet

      - name: 2. Tailscale Login (Check Stars)
        shell: powershell
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          Write-Host "`n******************************************************"
          Write-Host ">>> CLICK THE LOGIN LINK BELOW <<<" -ForegroundColor Yellow
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --accept-dns=false
          Write-Host "******************************************************`n"
          Start-Sleep -Seconds 120

      - name: 3. Deploy 40-Tabs "No-Video" Beast
        run: |
          $finalScript = @"
          import os, time, subprocess, threading, pyautogui, random, psutil

          def boost_cpu():
              p = psutil.Process(os.getpid())
              p.nice(psutil.HIGH_PRIORITY_CLASS)

          def anti_sleep():
              while True:
                  time.sleep(random.randint(20, 45))
                  pyautogui.press('scrolllock')

          def launch_browsers():
              ff_path = r'C:\Program Files\Mozilla Firefox\firefox.exe'
              base_dir = r'C:\Users\Public\TitanUltra'
              
              for i in range(40): 
                  p_dir = os.path.join(base_dir, str(i))
                  if not os.path.exists(p_dir): os.makedirs(p_dir)
                  
                  prefs_path = os.path.join(p_dir, "prefs.js")
                  with open(prefs_path, "w") as f:
                      f.write('user_pref("network.proxy.type", 1);\n')
                      f.write('user_pref("network.proxy.http", "45.152.188.238");\n')
                      f.write('user_pref("network.proxy.http_port", 3128);\n')
                      f.write('user_pref("network.proxy.ssl", "45.152.188.238");\n')
                      f.write('user_pref("network.proxy.ssl_port", 3128);\n')
                      f.write('user_pref("permissions.default.image", 2);\n')
                      f.write('user_pref("media.volume_scale", "0.0");\n')
                      f.write('user_pref("layers.acceleration.disabled", true);\n')
                      # --- NO-VIDEO HACK ---
                      f.write('user_pref("media.autoplay.default", 0);\n')
                      f.write('user_pref("media.peerconnection.enabled", false);\n')
                      f.write('user_pref("media.stagefright.enabled", false);\n')

                  # Play video in a way that minimizes rendering
                  url = "https://www.youtube.com/watch?v=OXuTuHQqB7s0"
                  subprocess.Popen([ff_path, "-new-instance", "-profile", p_dir, "-no-remote", url])
                  time.sleep(random.randint(10, 15))

          if __name__ == "__main__":
              boost_cpu()
              threading.Thread(target=anti_sleep, daemon=True).start()
              launch_browsers()
          "@
          $finalScript | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_ULTRA.py" -Encoding ascii
          "@echo off`ntitle TITAN FIXED OVERCLOCK`npython C:\Users\Public\Desktop\TITAN_ULTRA.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START.bat" -Encoding ascii

      - name: 4. Keep-Alive
        run: Start-Sleep -Seconds 9000
