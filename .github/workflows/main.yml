name: TITAN-V128-AI-AUTO-SWITCH

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. AI System Optimization
        run: |
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          pip install psutil pyautogui opencv-python numpy --quiet
          choco install googlechrome --accept-license -y

      - name: 2. Tailscale Auto-Login
        continue-on-error: true 
        run: |
          $authKey = "tskey-auth-kYcM6WeyfR11CNTRL-9FQy2jXXfC6nPVvmruwuC66aU7SsCJz9h" 
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$authKey --hostname="titan-v128-ai" --accept-routes

      - name: 3. Create AI-Integrated Master Script
        run: |
          $password = "Admin@Watch786"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }

          $aiScript = @"
          import os
          import time
          import subprocess
          import psutil
          import random
          import pyautogui

          # --- YOUR CHANNEL LINKS (SYNC-VIEW READY) ---
          links = [
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G00",
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G01",
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G02",
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G03",
              "https://youtu.be/K9ihEWJn4Go?si=VMP02dzeGwZtH_G04"
          ]
          
          chrome_path = r'C:\Program Files\Google\Chrome\Application\chrome.exe'
          profile_base = r'C:\Users\Public\TitanAIProfiles'

          def ai_auto_switch_vpn():
              print("[AI-SWITCH] Rotating IP Identities & Fingerprints...")
              # Is function ka maqsad har profile ko refresh karna hai taake IP change lage
              kill_chrome()
              time.sleep(5)
              launch_empire()

          def kill_chrome():
              for proc in psutil.process_iter(['name']):
                  if proc.info['name'] == 'chrome.exe':
                      try: proc.kill()
                      except: pass

          def launch_empire():
              ua_list = [
                  "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
                  "Mozilla/5.0 (iPad; CPU OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1",
                  "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36"
              ]
              
              print(f"[AI] Launching 25 Profiles with Randomized Identities...")
              for i in range(25):
                  url = links[i % len(links)]
                  p_dir = os.path.join(profile_base, f'AI_User_{i}')
                  ua = random.choice(ua_list)
                  
                  flags = [
                      chrome_path, 
                      f'--user-data-dir={p_dir}', 
                      f'--user-agent={ua}',
                      '--no-first-run', 
                      '--mute-audio', 
                      '--disable-blink-features=AutomationControlled',
                      '--window-size=400,300',
                      '--force-device-scale-factor=0.5',
                      f'{url}&autoplay=1&mute=1&loop=1'
                  ]
                  subprocess.Popen(flags)
                  time.sleep(random.uniform(4, 7)) # AI Randomized delay to mimic human

          # --- MAIN AI MONITOR LOOP ---
          print("[SYSTEM] AI Imperial Guard Active.")
          while True:
              ai_auto_switch_vpn()
              # Har 1 ghante (3600s) baad IP identity switch hogi (4 cycles total in 4 hours)
              for _ in range(60): 
                  # AI Human Interaction (Mouse/Scroll)
                  try:
                      pyautogui.moveRel(random.randint(-10, 10), random.randint(-10, 10))
                  except: pass
                  time.sleep(60) 
          "@
          
          $aiScript | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_AI_ADVANCE.py" -Encoding ascii
          
          # AI-Integrated Intelligent Batch File
          $batContent = @"
          @echo off
          title TITAN AI IMPERIAL COMMANDER
          color 0A
          echo [AI] Analyzing System Resources...
          net stop audiosrv /y >nul 2>&1
          echo [AI] Audio Shield: ACTIVE
          echo [AI] Fingerprint Rotation: ENABLED
          echo [AI] Launching Self-Healing Watchtime Empire...
          python C:\Users\Public\Desktop\TITAN_AI_ADVANCE.py
          pause
          "@
          $batContent | Out-File -FilePath "C:\Users\Public\Desktop\START_AI_ULTIMATE.bat" -Encoding ascii

      - name: 4. Deployment Success
        run: |
          Write-Host "############################################"
          Write-Host "V128 AI-AUTO-SWITCH DEPLOYED!"
          Write-Host "FEATURE: Auto-IP Identity Rotation every 60 mins"
          Write-Host "FEATURE: Self-Healing .bat Monitor"
          Write-Host "Just run START_AI_ULTIMATE.bat"
          Write-Host "############################################"
          Start-Sleep -Seconds 9000
