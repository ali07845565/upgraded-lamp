name: TITAN-V144-FINAL-ULTIMATUM

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9600

    steps:
      - name: 1. Deep System Prep
        run: |
          # Faltu services band karke RAM bachana
          Stop-Service -Name wuauserv, SysMain, AudioEndpointBuilder, audiosrv -Force
          pip install psutil requests --quiet
          choco install googlechrome --accept-license -y

      - name: 2. Tailscale API Login & Terminal IP Output
        shell: powershell
        run: |
          # Tailscale Installation
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          Invoke-WebRequest -Uri $tsUrl -OutFile "ts.msi"
          Start-Process msiexec.exe -ArgumentList "/i", "ts.msi", "/quiet", "/norestart" -Wait
          
          # Connecting with your API Token
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=tskey-api-k51fmL77NN11CNTRL-JtoyQjqtRCZ3utdaCWfDCZVzxPL6GdAH --hostname="Titan-RDP-Final" --accept-routes
          
          # Waiting for IP Assignment
          Start-Sleep -Seconds 12
          $tsIP = (& "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4)
          
          # --- OUTPUT TO GITHUB TERMINAL ---
          Write-Host "`n`n"
          Write-Host "**********************************************" -ForegroundColor Cyan
          Write-Host "   SUCCESS! RDP IS READY TO CONNECT" -ForegroundColor Green
          Write-Host "   IP ADDRESS: $tsIP" -ForegroundColor Yellow -BackgroundColor Black
          Write-Host "   USERNAME:   RDP" -ForegroundColor White
          Write-Host "   PASSWORD:   Admin@Watch786" -ForegroundColor White
          Write-Host "**********************************************" -ForegroundColor Cyan
          Write-Host "`n`n"

      - name: 3. Create Hardened Proxy Master Script
        run: |
          $password = "Admin@Watch786"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          if (!(Get-LocalUser -Name "RDP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "RDP" -Password $securePass -AccountNeverExpires
              Add-LocalGroupMember -Group "Administrators" -Member "RDP"
          }

          $finalScript = @"
          import os, time, subprocess, psutil, requests, random

          links = [
              "https://m.youtube.com/watch?v=oiyYa3IL2Rc",
              "https://m.youtube.com/watch?v=OXuTuHQqB7s",
              "https://m.youtube.com/watch?v=K9ihEWJn4Go",
              "https://m.youtube.com/watch?v=z25lo2mogbk",
              "https://m.youtube.com/watch?v=ZkJlQ_q7x5Q"
          ]

          def get_proxies():
              try:
                  # SOCKS5 fresh proxies fetch karna
                  r = requests.get("https://api.proxyscrape.com/v2/?request=displayproxies&protocol=socks5&timeout=10000&country=all&ssl=all&anonymity=all")
                  return [p.strip() for p in r.text.splitlines() if p.strip()] if r.status_code == 200 else []
              except: return []

          def start_browsers():
              proxies = get_proxies()
              if not proxies: return
              chrome = r'C:\Program Files\Google\Chrome\Application\chrome.exe'
              
              for i in range(25):
                  p_dir = f'C:\Users\Public\TitanProfile_{i}'
                  proxy = random.choice(proxies)
                  
                  # Hardened Flags: In flags se YouTube bot nahi pakad payega
                  flags = [
                      chrome, f'--user-data-dir={p_dir}', f'--proxy-server=socks5://{proxy}',
                      '--disable-blink-features=AutomationControlled', '--mute-audio',
                      '--window-size=400,300', '--force-device-scale-factor=0.5',
                      '--user-agent=Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Mobile Safari/537.36',
                      '--no-first-run', '--no-default-browser-check', links[i % len(links)]
                  ]
                  subprocess.Popen(flags)
                  time.sleep(12) # Human delay

          while True:
              [p.kill() for p in psutil.process_iter(['name']) if p.info['name'] == 'chrome.exe']
              time.sleep(5)
              start_browsers()
              time.sleep(10800) # 3 ghante baad reset
          "@
          $finalScript | Out-File -FilePath "C:\Users\Public\Desktop\TITAN_FINAL.py" -Encoding ascii
          "@echo off`npython C:\Users\Public\Desktop\TITAN_FINAL.py`npause" | Out-File -FilePath "C:\Users\Public\Desktop\START.bat" -Encoding ascii

      - name: 4. Keep Alive
        run: Start-Sleep -Seconds 9000
